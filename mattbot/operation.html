<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MattBot Operation Guide | Matthew Sato</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .header {
            text-align: center;
            background: rgba(255, 255, 255, 0.95);
            padding: 3rem 2rem;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 3rem;
            margin-bottom: 0.5rem;
            font-weight: 300;
        }
        
        .header .subtitle {
            color: #7f8c8d;
            font-size: 1.3rem;
            margin-bottom: 1.5rem;
        }
        
        .nav-links {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .nav-link {
            display: inline-block;
            background: #3498db;
            color: white;
            padding: 0.75rem 1.5rem;
            text-decoration: none;
            border-radius: 25px;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .nav-link:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .nav-link.back {
            background: #95a5a6;
        }
        
        .nav-link.back:hover {
            background: #7f8c8d;
        }
        
        .section {
            background: rgba(255, 255, 255, 0.95);
            padding: 2.5rem;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        .section h2 {
            color: #2c3e50;
            font-size: 2.2rem;
            margin-bottom: 1.5rem;
            text-align: center;
            border-bottom: 3px solid #e74c3c;
            padding-bottom: 0.5rem;
        }
        
        .section h3 {
            color: #c0392b;
            font-size: 1.5rem;
            margin: 2rem 0 1rem 0;
        }
        
        .section p, .section li {
            color: #555;
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }
        
        .step-card {
            background: #f8f9fa;
            padding: 2rem;
            border-radius: 10px;
            margin: 1.5rem 0;
            border-left: 5px solid #c0392b;
        }
        
        .step-number {
            background: #c0392b;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 1rem;
        }
        
        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 1rem;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 1rem 0;
            overflow-x: auto;
        }
        
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }
        
        .warning strong {
            color: #e17055;
        }
        
        .tip {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }
        
        .tip strong {
            color: #0c5460;
        }
        
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        
        .control-card {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
            border-left: 4px solid #e74c3c;
            text-align: center;
        }
        
        .control-card h4 {
            color: #2c3e50;
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }
        
        .key-combo {
            background: #e74c3c;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-family: monospace;
            font-weight: bold;
            margin: 0.25rem;
            display: inline-block;
        }
        
        .mode-card {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 1.5rem;
            border-radius: 10px;
            margin: 1rem 0;
        }
        
        .mode-card h4 {
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }
        
        .back-to-top {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #e74c3c;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            font-size: 1.5rem;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
            transition: all 0.3s ease;
            opacity: 0;
            visibility: hidden;
            z-index: 1000;
        }
        
        .back-to-top.visible {
            opacity: 1;
            visibility: visible;
        }
        
        .back-to-top:hover {
            background: #c0392b;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .section {
                padding: 1.5rem;
            }
            
            .nav-links {
                flex-direction: column;
                align-items: center;
            }
            
            .controls-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>Operation Guide</h1>
            <p class="subtitle">Learn to Operate the Mobile Robot</p>
            <div class="nav-links">
                <a href="instructions.html" class="nav-link back">‚Üê Instructions Hub</a>
                <a href="construction.html" class="nav-link">‚Üê Construction Guide</a>
                <a href="setup.html" class="nav-link">‚Üê Setup Guide</a>
            </div>
        </header>
        
        <section class="section">
            <h2>Getting Started</h2>
            <p>Welcome to the operation of the mobile robot! This guide assumes you have successfully completed construction and setup. Your robot should be powered on, connected to WiFi, and all systems verified.</p>
        </section>
        
        <section class="section">
            <h2>Preparing the Mobile Robots</h2>
            
            <div class="step-card">
                <div class="step-number">1</div>
                <h3>System Startup</h3>
                <p>Power on the NVIDIA Jetson and the Microcontroller.</p>
                <p>Establish SSH connection to the robot:</p>
                <div class="code-block">
                ssh jetson@&lt;robot_ip_address&gt;
                </div>
                <p>Load the spidev module:</p>
                <div class="code-block">
                sudo modprobe spidev
                </div>
                <div class="tip">
                    <strong>üí° Tip:</strong> Add spidev to /etc/modules-load.d/spidev.conf to automatically load this at startup
                </div>
            </div>
            
            <div class="step-card">
                <div class="step-number">2</div>
                <h3>Start the Docker Containers</h3>
                <p>Start the ROS Container:</p>
                <div class="code-block">
                jetson-containers run -v ~/workspaces/catkin_ws:/workspace/catkin_ws -v ~/gemini_api:/gemini_code -v /dev/bus/usb:/dev/bus/usb -v /dev/video0:/dev/video0 -v /dev/video1:/dev/video1 -i --device=/dev/ttyUSB0 --device=/dev/spidev0.0 --rm --privileged --name ros_noetic $(autotag ml_ros:latest)
                </div>
                <p>Open other terminals and enter the container (as needed):</p>
                <div class="code-block">
                docker exec -it ros_noetic bash
                </div>

                <p>Start the Gemini Container:</p>
                <div class="code-block">
                sudo docker run -v ~/gemini_api:/gemini_code -v ~/Desktop/audio:/audio -w /gemini_code -it --rm --privileged -p 5000:5000  --name gemini gemini:latest
                </div>
            </div>
        </section>
        
        <section class="section">
            <h2>User GUI/Communication</h2>
            <div class="tip">
                I run everything on a Windows machine. I use WSL (windows subsystem for Linux) to run the DDS scripts and the Windows command line to run the GUI. If you are using a different OS, you may need to adjust the commands accordingly.
            </div>
        
            <div class="step-card">
                <div class="step-number">1</div>
                <h3>Start the user DDS node</h3>
                <p>Open three terminals in WSL</p>

                <p>Start the Docker containers in the first terminal</p>
                <div class="code-block">
                cd dds_robot_platform<br>
                docker compose up -d
                </div>
                To stop the containers, run:
                <div class="code-block">
                docker compose down
                </div>

                <p>In the second terminal, start the DDS scripts:</p>
                <div class="code-block">
                cd dds_robot_platform/dds<br>
                . start_scripts.sh
                </div>

                <div class="tip">Ensure you have set the agent_id by adding <code>export AGENT_ID=xxx</code> in the ~/.bashrc file.</div>

                
                <p>The DDS scripts can be stopped by running <code>. stop_scripts.sh</code> in the third terminal.
                
                <p>After running these commands, the user node will be active and participate in the DDS network.</p>
            </div>

            <div class="step-card">
                <div class="step-number">2</div>
                <h3>Start the GUI</h3>
                <p>In windows command line, navigate to the GUI directory and start the server:</p>
                <div class="code-block">
                cd dds_robot_platform/gui<br>
                serve -s build
                </div>
                <p>Now go to <a href="http://localhost:3000" target="_blank">http://localhost:3000</a> in your web browser to view the GUI.</p>
            </div>
        </section>

        <section class="section">
            <h2>Using the GUI</h2>

            <div class="step-card">
                <h3>GUI Overview</h3>
                <p>The GUI provides a web-based interface for monitoring and controlling the robots on your machine.</p>
                <img src="images/gui_overview.png" alt="GUI Overview" style="width: 100%; border-radius: 8px; margin: 1rem 0; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                
                <h4>Main Features:</h4>
                <ul>
                    <li><strong>Robot Status Panel:</strong> Shows online robots</li>
                    <li><strong>Click Function:</strong> Choose what clicking on the map does</li>
                    <li><strong>Map Visualization:</strong> Displays robot positions and environment map</li>
                </ul>
            </div>

            <div class="controls-grid">
                <div class="control-card">
                    <h4>Select Robot</h4>
                    <p>Click on a robot in the status panel to select it for control</p>
                </div>
                
                <div class="control-card">
                    <h4>Robot Orientation</h4>
                    <p>Set the robot orientation when setting a goal or initial position</p>
                </div>
                
                <div class="control-card">
                    <h4>Clicking Function</h4>
                    <p>Selecting "Set Robot Goal" means clicking on the map will set goal position for a robot. Selection "Set Initial Position" means clicking will set the robot's starting position.</p>
                </div>
            </div>

            <div class="step-card">
                <h3>Workflow</h3>
                <p>Follow these steps to control a robot with the GUI:</p>
                
                <div class="control-card">
                    <h4>Step 1: Connect to Robot</h4>
                    <p>When a mobile robot enters the network, it will automatically appear in the Robot Status Panel on the left side of the GUI.</p>
                </div>

                <div class="control-card">
                    <h4>Step 2: Set Initial Position</h4>
                    <p>Select the robot from the status panel, then choose "Set Initial Position".</p>
                    <p>Adjust the orientation using the orientation slider to match the robot's approximate initial orientation.</p>
                    <p>Click on the map where the robot is currently located to set its approximate initial position.</p>
                    
                    <div class="tip">
                        <strong>üí° Tip:</strong> Setting an accurate initial position helps the robot localize correctly in the environment.
                    </div>
                </div>

                <div class="control-card">
                    <h4>Step 3: Send Robot to Goal</h4>
                    <p>After the robot is initialized, change the clicking function to "Set Robot Goal".</p>
                    <p>Click anywhere on the map to set a navigation goal for the robot.</p>
                    <p>The robot will plan a path and start moving toward the goal location.</p>
                </div>
            </div>

        </section>

        <section class="section">
            <h2>Operating the Mobile Robots</h2>
            
            <div class="step-card">
                <div class="step-number">1</div>
                <h3>Launch Files</h3>
                <p>There are several launch files used to support running the mobile robots.</p>
                <p>Below is a summary of the important launch files:</p>
                <ul>
                    <li><strong>minimal.launch</strong> - Launches the minimal robot with connection to the MCU.</li>
                    <li><strong>short.launch</strong> - Launches the full software stack for the short robot.</li>
                    <li><strong>tall.launch</strong> - Launches the full software stack for the tall robot.</li>
                    <li><strong>sense_and_map.launch</strong> - Launches the software stack for creating a map using SLAM</li>
                </ul>

                <p>Some optional arguments include:</p>
                <ul>
                    <li><strong>car</strong> - Set to true if using a mobile robot with wheels at the back (default: false)</li>
                    <li><strong>patrol</strong> - Set to true if mobile robot should follow the defined patrol path (default: false)</li>
                </ul>

                <p>To run any of the launch files, follow this format:</p>
                <pre><code>roslaunch mattbot_bringup &lt;launch_file&gt; [arguments:=arg_value]</code></pre>

            </div>

            <div class="step-card">
                <div class="step-number">2</div>
                <h3>Creating a Map</h3>

                <p>Start the mapping software by running the following command:</p>
                <pre><code>roslaunch mattbot_bringup sense_and_map.launch</code></pre>

                <p>In a second terminal, start robot teleoperation:</p>
                <pre><code>roslaunch mattbot_teleop keyboard.launch</code></pre>

                <p>Use the keyboard controls to move the robot around and create a map of the environment. The robot should visit all areas of the space to build a comprehensive map.</p>
                <p>Once the mapping is complete, save the map using the following command:</p>
                <pre><code>rosrun map_server map_saver -f &lt;map_name&gt; map:=/map</code></pre>

                <p>My navigation software requires (and allows) for the human to modify the map. Make a copy of the map with the name &lt;map_name&gt;_mod.pgm. Use some image editing software (i.e., GIMP) to add barriers that you wish the mobile robot to avoid. Now, copy three (3) files to the ~/workspace/catkin_ws/src/mattbot_mcl/maps directory:</p>
                <ul>
                    <li>&lt;map_name&gt;.yaml</li>
                    <li>&lt;map_name&gt;.pgm</li>
                    <li>&lt;map_name&gt;_mod.pgm</li>
                </ul>

                <p>Last, create an occupancy grid for the map by running <code>python3 ./generate_dds_map.py --map_file &lt;map_name&gt;</code> within the ~/workspace/catkin_ws/src/mattbot_mcl/scripts directory.</p>

                <p>The last thing to do is to copy the json version of the map to the user GUI directory. Copy the file: ~/workspace/catkin_ws/src/mattbot_mcl/map_json/current_map.json to your machine running the user GUI. The file should be saved in the dds_robot_platform/dds directory named as user_map.json.</p> 
            </div>

            <div class="step-card">
                <div class="step-number">3</div>
                <h3>Normal Operation of the Robots</h3>
                <p>To run the mobile robots, simply call the appropriate launch file:</p>
                <pre><code>roslaunch mattbot_bringup tall.launch</code></pre>
                <p>The mobile robot will connect to the DDS network, and you can control the mobile robot goals via the GUI.</p>
            </div>

            <div class="step-card">
                <div class="step-number">4</div>
                <h3>Shutting down the robots</h3>

                <p>To shut down the software stack, simply perform a <code>ctrl+c</code> command in the terminal. Alternatively, you can use the following command:</p>
                <pre><code>rosnode kill -a</code></pre>

                <p>To exit the docker containers, simply run <code>exit</code> in the terminal.</p>

                <p>To shutdown the Jetson, run the following command:</p>
                <pre><code>sudo shutdown -h now</code></pre>
                <p>Please shutdown using this command rather than simply powering off the device.</p>
            </div>

        </section>

        <section class="section">
            
            <div class="tip">
                <strong>Congratulations!</strong> You now have the knowledge to operate your mobile robot safely and effectively. Now you can modify the code for your own application!
            </div>
        </section>
    </div>
    
    <!-- Back to Top Button -->
    <a href="#" class="back-to-top" id="backToTop">‚Üë</a>
    
    <script>
        // Back to top functionality
        const backToTopButton = document.getElementById('backToTop');
        
        // Show/hide button based on scroll position
        window.addEventListener('scroll', function() {
            if (window.pageYOffset > 300) {
                backToTopButton.classList.add('visible');
            } else {
                backToTopButton.classList.remove('visible');
            }
        });
        
        // Smooth scroll to top when clicked
        backToTopButton.addEventListener('click', function(e) {
            e.preventDefault();
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });
    </script>
</body>
</html>
